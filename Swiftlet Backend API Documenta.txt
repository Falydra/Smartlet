# SwiftLead API Documentation

**Base URL:** `https://api.swiftlead.fuadfakhruz.com`  
**API Version:** `v1`  
**Prefix:** `/api/v1`

---

## Table of Contents

1. [Overview](#1-overview)
2. [Authentication](#2-authentication)
3. [Auth Endpoints](#3-auth-endpoints)
4. [User Endpoints](#4-user-endpoints)
5. [RBW Endpoints](#5-rbw-rumah-burung-walet-endpoints)
6. [Node Endpoints](#6-node-iot-device-endpoints)
7. [Sensor Endpoints](#7-sensor-endpoints)
8. [Alert Endpoints](#8-alert-endpoints)
9. [Harvest Endpoints](#9-harvest-endpoints)
10. [Service Request Endpoints](#10-service-request-endpoints)
11. [Transaction Endpoints](#11-transaction-endpoints)
12. [Transaction Category Endpoints](#12-transaction-category-endpoints)
13. [Financial Statement Endpoints](#13-financial-statement-endpoints)
14. [AI Engine Endpoints](#14-ai-engine-endpoints)
15. [Upload Endpoints](#15-upload-endpoints)
16. [WebSocket Endpoints](#16-websocket-endpoints)
17. [Health & Metrics](#17-health--metrics)

---

## 1. Overview

### Standard Response Format

All API responses follow this structure:

```json
{
  "success": true,
  "message": "Optional message",
  "data": {},
  "meta": {
    "total": 100,
    "page": 1,
    "limit": 20,
    "total_pages": 5
  }
}
```

### Error Response Format

```json
{
  "success": false,
  "message": "Error description",
  "error": "error_code"
}
```

### Error Codes

| HTTP Status | Error Code           | Description                                  |
| ----------- | -------------------- | -------------------------------------------- |
| 400         | `bad_request`        | Invalid request body or parameters           |
| 401         | `unauthorized`       | Missing or invalid authentication            |
| 403         | `forbidden`          | Insufficient permissions                     |
| 404         | `not_found`          | Resource not found                           |
| 405         | `method_not_allowed` | HTTP method not allowed                      |
| 409         | `conflict`           | Resource already exists                      |
| 422         | `validation_error`   | Validation failed (includes `details` field) |
| 500         | `internal_error`     | Internal server error                        |
| 503         | `ai_disabled`        | AI Engine is disabled                        |

### Pagination

Endpoints that return lists support pagination:

| Query Param | Type | Default | Description    |
| ----------- | ---- | ------- | -------------- |
| `page`      | int  | 1       | Page number    |
| `limit`     | int  | 20      | Items per page |

### User Roles

| Role         | Description                                  |
| ------------ | -------------------------------------------- |
| `admin`      | Full access, can manage users and categories |
| `technician` | Technical operations                         |
| `farmer`     | Default role for public registration         |

### Date Format

All dates use **ISO 8601** format: `2026-02-09T08:00:00Z`

---

## 2. Authentication

All protected endpoints require a JWT Bearer token in the `Authorization` header:

```
Authorization: Bearer <token>
```

Token is obtained from the login endpoint. Include this header in all requests to protected endpoints.

---

## 3. Auth Endpoints

### POST `/api/v1/auth/register` â€” Public Registration

Register a new user (defaults to `farmer` role).

**Auth:** None

**Request Body:**

```json
{
  "name": "John Doe",
  "email": "john@example.com",
  "password": "SecurePass123!@",
  "phone": "081234567890"
}
```

| Field      | Type   | Required | Validation                                                       |
| ---------- | ------ | -------- | ---------------------------------------------------------------- |
| `name`     | string | âœ…       | 2-100 characters                                                 |
| `email`    | string | âœ…       | Valid email                                                      |
| `password` | string | âœ…       | Min 8 chars, must have uppercase, lowercase, digit, special char |
| `phone`    | string | âŒ       | -                                                                |

**Response:** `201 Created`

```json
{
  "success": true,
  "message": "Registration successful",
  "data": {
    "id": "uuid",
    "name": "John Doe",
    "email": "john@example.com",
    "role": "farmer",
    "phone": "081234567890",
    "created_at": "2026-02-09T10:00:00Z",
    "updated_at": "2026-02-09T10:00:00Z"
  }
}
```

**Errors:**

- `400` â€” Weak password or invalid body
- `409` â€” Email already registered

---

### POST `/api/v1/auth/login` â€” Login

**Auth:** None

**Request Body:**

```json
{
  "email": "john@example.com",
  "password": "SecurePass123!@"
}
```

| Field      | Type   | Required |
| ---------- | ------ | -------- |
| `email`    | string | âœ…       |
| `password` | string | âœ…       |

**Response:** `200 OK`

```json
{
  "success": true,
  "message": "Login successful",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIs...",
    "user": {
      "id": "uuid",
      "name": "John Doe",
      "email": "john@example.com",
      "role": "farmer",
      "phone": "081234567890",
      "avatar_url": null,
      "created_at": "2026-02-09T10:00:00Z",
      "updated_at": "2026-02-09T10:00:00Z"
    }
  }
}
```

**Errors:**

- `400` â€” Invalid request body
- `401` â€” Invalid email or password

---

### POST `/api/v1/auth/change-password` â€” Change Password

**Auth:** ğŸ”’ Bearer Token

**Request Body:**

```json
{
  "old_password": "OldPass123!@",
  "new_password": "NewPass456!@"
}
```

| Field          | Type   | Required | Validation                                           |
| -------------- | ------ | -------- | ---------------------------------------------------- |
| `old_password` | string | âœ…       | -                                                    |
| `new_password` | string | âœ…       | Min 8 chars, uppercase + lowercase + digit + special |

**Response:** `200 OK`

```json
{
  "success": true,
  "message": "Password changed successfully"
}
```

**Errors:**

- `400` â€” Same password / weak password
- `401` â€” Old password incorrect

---

### POST `/api/v1/auth/forgot-password` â€” Admin Reset Password

Reset a user's password (generates temporary password).

**Auth:** ğŸ”’ Bearer Token (Admin only)

**Request Body:**

```json
{
  "email": "user@example.com"
}
```

**Response:** `200 OK`

```json
{
  "success": true,
  "message": "Password has been reset",
  "data": {
    "temporary_password": "aB3$xYz9!qW2",
    "message": "Please change the password after login"
  }
}
```

**Errors:**

- `404` â€” User not found

---

## 4. User Endpoints

### GET `/api/v1/users/me` â€” Get My Profile

**Auth:** ğŸ”’ Bearer Token

**Response:** `200 OK`

```json
{
  "success": true,
  "data": {
    "id": "uuid",
    "name": "John Doe",
    "email": "john@example.com",
    "role": "farmer",
    "phone": "081234567890",
    "avatar_url": "https://...",
    "created_at": "2026-02-09T10:00:00Z",
    "updated_at": "2026-02-09T10:00:00Z"
  }
}
```

---

### PATCH `/api/v1/users/me` â€” Update My Profile

**Auth:** ğŸ”’ Bearer Token

**Request Body** (all optional):

```json
{
  "name": "Updated Name",
  "phone": "089876543210",
  "avatar_url": "https://example.com/avatar.jpg"
}
```

| Field        | Type   | Required | Validation        |
| ------------ | ------ | -------- | ----------------- |
| `name`       | string | âŒ       | 2-100 characters  |
| `phone`      | string | âŒ       | -                 |
| `avatar_url` | string | âŒ       | Must be valid URL |

**Response:** `200 OK`

```json
{
  "success": true,
  "message": "Profile updated",
  "data": { "...user object..." }
}
```

---

### GET `/api/v1/users` â€” List Users (Admin)

**Auth:** ğŸ”’ Bearer Token (Admin only)

**Query Parameters:**

| Param   | Type   | Default | Description                                     |
| ------- | ------ | ------- | ----------------------------------------------- |
| `page`  | int    | 1       | Page number                                     |
| `limit` | int    | 20      | Items per page                                  |
| `role`  | string | -       | Filter by role: `admin`, `technician`, `farmer` |

**Response:** `200 OK`

```json
{
  "success": true,
  "data": [
    {
      "id": "uuid",
      "name": "John Doe",
      "email": "john@example.com",
      "role": "farmer",
      "phone": "081234567890",
      "avatar_url": null,
      "created_at": "2026-02-09T10:00:00Z",
      "updated_at": "2026-02-09T10:00:00Z"
    }
  ],
  "meta": {
    "total": 50,
    "page": 1,
    "limit": 20,
    "total_pages": 3
  }
}
```

---

### POST `/api/v1/users` â€” Create User (Admin)

**Auth:** ğŸ”’ Bearer Token (Admin only)

**Request Body:**

```json
{
  "name": "New Technician",
  "email": "tech@example.com",
  "password": "TechPass123!@",
  "role": "technician",
  "phone": "081234567890"
}
```

| Field      | Type   | Required | Validation                         |
| ---------- | ------ | -------- | ---------------------------------- |
| `name`     | string | âœ…       | 2-100 characters                   |
| `email`    | string | âœ…       | Valid email                        |
| `password` | string | âœ…       | Min 8 characters                   |
| `role`     | string | âœ…       | `admin`, `technician`, or `farmer` |
| `phone`    | string | âŒ       | -                                  |

**Response:** `201 Created`

---

## 5. RBW (Rumah Burung Walet) Endpoints

### POST `/api/v1/rbw` â€” Create RBW

**Auth:** ğŸ”’ Bearer Token

**Request Body:**

```json
{
  "code": "RBW-001",
  "name": "Rumah Walet Jakarta",
  "address": "Jl. Merdeka No. 1",
  "latitude": -6.2088,
  "longitude": 106.8456,
  "total_floors": 3,
  "description": "Walet house description"
}
```

| Field          | Type   | Required | Description      |
| -------------- | ------ | -------- | ---------------- |
| `code`         | string | âœ…       | Unique RBW code  |
| `name`         | string | âœ…       | RBW name         |
| `address`      | string | âŒ       | Physical address |
| `latitude`     | float  | âŒ       | GPS latitude     |
| `longitude`    | float  | âŒ       | GPS longitude    |
| `total_floors` | int    | âœ…       | Number of floors |
| `description`  | string | âŒ       | Description      |

**Response:** `201 Created`

```json
{
  "success": true,
  "message": "RBW created",
  "data": {
    "id": "uuid",
    "owner_id": "uuid",
    "code": "RBW-001",
    "name": "Rumah Walet Jakarta",
    "address": "Jl. Merdeka No. 1",
    "latitude": -6.2088,
    "longitude": 106.8456,
    "total_floors": 3,
    "description": "Walet house description",
    "photo_url": null,
    "created_at": "2026-02-09T10:00:00Z",
    "updated_at": "2026-02-09T10:00:00Z"
  }
}
```

---

### GET `/api/v1/rbw` â€” List RBWs

**Auth:** ğŸ”’ Bearer Token

**Query:** `?page=1&limit=20`

**Response:** `200 OK` â€” Array of RBW objects with pagination meta.

---

### GET `/api/v1/rbw/{rbw_id}` â€” Get RBW

**Auth:** ğŸ”’ Bearer Token

**Response:** `200 OK` â€” Single RBW object.

**Errors:** `404` â€” RBW not found.

---

### PATCH `/api/v1/rbw/{rbw_id}` â€” Update RBW

**Auth:** ğŸ”’ Bearer Token

**Request Body** (all optional):

```json
{
  "name": "Updated Name",
  "address": "New Address",
  "latitude": -6.21,
  "longitude": 106.85,
  "total_floors": 4,
  "description": "Updated description",
  "photo_url": "https://..."
}
```

**Response:** `200 OK` â€” Updated RBW object.

---

### DELETE `/api/v1/rbw/{rbw_id}` â€” Delete RBW

**Auth:** ğŸ”’ Bearer Token

**Response:** `200 OK`

---

## 6. Node (IoT Device) Endpoints

### POST `/api/v1/rbw/{rbw_id}/nodes` â€” Create Node

**Auth:** ğŸ”’ Bearer Token

**Request Body:**

```json
{
  "node_type": "gateway",
  "node_code": "GW-001",
  "esp32_uid": "AA:BB:CC:DD:EE:FF",
  "has_audio": true,
  "has_pump": true
}
```

| Field       | Type   | Required | Values                           |
| ----------- | ------ | -------- | -------------------------------- |
| `node_type` | string | âœ…       | `gateway`, `nest`, `lmb`, `pump` |
| `node_code` | string | âœ…       | Unique node code                 |
| `esp32_uid` | string | âŒ       | ESP32 hardware UID               |
| `has_audio` | bool   | âœ…       | Has audio capability             |
| `has_pump`  | bool   | âœ…       | Has pump capability              |

**Response:** `201 Created`

```json
{
  "success": true,
  "data": {
    "id": "uuid",
    "rbw_id": "uuid",
    "node_type": "gateway",
    "node_code": "GW-001",
    "esp32_uid": "AA:BB:CC:DD:EE:FF",
    "status_node": "offline",
    "last_seen": null,
    "has_audio": true,
    "state_audio_lmb": null,
    "state_audio_nest": null,
    "has_pump": true,
    "state_pump": null,
    "installed_at": null,
    "uninstalled_at": null,
    "created_at": "2026-02-09T10:00:00Z",
    "updated_at": "2026-02-09T10:00:00Z"
  }
}
```

---

### GET `/api/v1/rbw/{rbw_id}/nodes` â€” List Nodes by RBW

**Auth:** ğŸ”’ Bearer Token

**Response:** `200 OK` â€” Array of Node objects.

---

### GET `/api/v1/nodes/{node_id}` â€” Get Node

**Auth:** ğŸ”’ Bearer Token

**Response:** `200 OK` â€” Single Node object.

---

### PATCH `/api/v1/nodes/{node_id}` â€” Update Node

**Auth:** ğŸ”’ Bearer Token

**Request Body** (all optional):

```json
{
  "node_code": "GW-UPDATED",
  "esp32_uid": "11:22:33:44:55:66",
  "has_audio": false,
  "has_pump": false
}
```

**Response:** `200 OK` â€” Updated Node object.

---

### DELETE `/api/v1/nodes/{node_id}` â€” Delete Node

**Auth:** ğŸ”’ Bearer Token

**Response:** `200 OK`

---

### GET `/api/v1/nodes/{node_id}/audio` â€” Get Audio State

**Auth:** ğŸ”’ Bearer Token

**Response:** `200 OK`

```json
{
  "success": true,
  "data": {
    "has_audio": true,
    "state_audio_lmb": true,
    "state_audio_nest": false
  }
}
```

---

### PATCH `/api/v1/nodes/{node_id}/audio` â€” Control Audio

**Auth:** ğŸ”’ Bearer Token

**Request Body:**

```json
{
  "action": "audio_set_lmb",
  "value": 1
}
```

| Field    | Type   | Values                                         |
| -------- | ------ | ---------------------------------------------- |
| `action` | string | `audio_set_lmb`, `audio_set_nest`, `call_bird` |
| `value`  | int    | `0` (off) or `1` (on)                          |

**Response:** `200 OK`

---

### PATCH `/api/v1/nodes/{node_id}/pump` â€” Control Pump

**Auth:** ğŸ”’ Bearer Token

**Request Body:**

```json
{
  "action": "sprayer_set",
  "value": 1
}
```

| Field    | Type   | Values                |
| -------- | ------ | --------------------- |
| `action` | string | `sprayer_set`         |
| `value`  | int    | `0` (off) or `1` (on) |

**Response:** `200 OK`

---

## 7. Sensor Endpoints

### POST `/api/v1/nodes/{node_id}/sensors` â€” Create Sensor

**Auth:** ğŸ”’ Bearer Token

**Request Body:**

```json
{
  "sensor_type": "temp",
  "sensor_name": "Temperature Sensor 1",
  "unit": "Â°C"
}
```

| Field         | Type   | Required | Values                     |
| ------------- | ------ | -------- | -------------------------- |
| `sensor_type` | string | âœ…       | `temp`, `humid`, `ammonia` |
| `sensor_name` | string | âŒ       | Display name               |
| `unit`        | string | âŒ       | Unit of measurement        |

**Response:** `201 Created`

```json
{
  "success": true,
  "data": {
    "id": "uuid",
    "node_id": "uuid",
    "sensor_type": "temp",
    "sensor_name": "Temperature Sensor 1",
    "unit": "Â°C",
    "is_active": true,
    "created_at": "2026-02-09T10:00:00Z",
    "updated_at": "2026-02-09T10:00:00Z"
  }
}
```

---

### GET `/api/v1/nodes/{node_id}/sensors` â€” List Sensors by Node

**Auth:** ğŸ”’ Bearer Token

**Response:** `200 OK` â€” Array of Sensor objects.

---

### GET `/api/v1/sensors/{sensor_id}` â€” Get Sensor

**Auth:** ğŸ”’ Bearer Token

**Response:** `200 OK` â€” Single Sensor object.

---

### PATCH `/api/v1/sensors/{sensor_id}` â€” Update Sensor

**Auth:** ğŸ”’ Bearer Token

**Request Body** (all optional):

```json
{
  "sensor_name": "Updated Sensor Name",
  "unit": "Â°F",
  "is_active": false
}
```

**Response:** `200 OK` â€” Updated Sensor object.

---

### POST `/api/v1/sensors/{sensor_id}/readings` â€” Create Sensor Reading

**Auth:** ğŸ”’ Bearer Token

**Request Body:**

```json
{
  "value": 28.5,
  "recorded_at": "2026-02-09T10:00:00Z"
}
```

| Field         | Type     | Required | Description                 |
| ------------- | -------- | -------- | --------------------------- |
| `value`       | float    | âœ…       | Sensor reading value        |
| `recorded_at` | datetime | âŒ       | Timestamp (defaults to now) |

**Response:** `201 Created`

```json
{
  "success": true,
  "data": {
    "id": 1,
    "sensor_id": "uuid",
    "recorded_at": "2026-02-09T10:00:00Z",
    "value": 28.5,
    "is_anomaly": false,
    "created_at": "2026-02-09T10:00:00Z"
  }
}
```

---

### GET `/api/v1/sensors/{sensor_id}/readings` â€” Get Sensor Readings

**Auth:** ğŸ”’ Bearer Token

**Query Parameters:**

| Param   | Type     | Default | Description       |
| ------- | -------- | ------- | ----------------- |
| `from`  | datetime | -       | Start time filter |
| `to`    | datetime | -       | End time filter   |
| `limit` | int      | 100     | Max readings      |

**Response:** `200 OK` â€” Array of SensorReading objects.

---

### GET `/api/v1/sensors/{sensor_id}/trend` â€” Get Sensor Trend

**Auth:** ğŸ”’ Bearer Token

**Response:** `200 OK`

```json
{
  "success": true,
  "data": {
    "sensor_id": "uuid",
    "sensor_type": "temp",
    "direction": "rising",
    "slope": 0.25,
    "avg_value": 28.5,
    "min_value": 27.0,
    "max_value": 30.0,
    "data_points": 50,
    "period": "24h0m0s"
  }
}
```

| Field         | Type   | Description                   |
| ------------- | ------ | ----------------------------- |
| `direction`   | string | `rising`, `falling`, `stable` |
| `slope`       | float  | Rate of change                |
| `avg_value`   | float  | Average value in period       |
| `min_value`   | float  | Minimum value in period       |
| `max_value`   | float  | Maximum value in period       |
| `data_points` | int    | Number of readings analyzed   |

---

## 8. Alert Endpoints

### GET `/api/v1/alerts` â€” List All Alerts

**Auth:** ğŸ”’ Bearer Token

**Query Parameters:**

| Param      | Type   | Description              |
| ---------- | ------ | ------------------------ |
| `page`     | int    | Page number              |
| `limit`    | int    | Items per page           |
| `rbw_id`   | string | Filter by RBW            |
| `severity` | int    | Filter by severity level |
| `is_read`  | bool   | Filter by read status    |

**Response:** `200 OK`

```json
{
  "success": true,
  "data": [
    {
      "id": "uuid",
      "rbw_id": "uuid",
      "node_id": "uuid",
      "sensor_id": "uuid",
      "alert_type": "temp_high",
      "severity": 3,
      "message": "Temperature exceeds 35Â°C",
      "is_read": false,
      "resolved_at": null,
      "resolved_by": null,
      "created_at": "2026-02-09T10:00:00Z"
    }
  ],
  "meta": { "..." }
}
```

### Alert Types

| Type           | Description            |
| -------------- | ---------------------- |
| `temp_high`    | Temperature too high   |
| `temp_low`     | Temperature too low    |
| `humid_high`   | Humidity too high      |
| `humid_low`    | Humidity too low       |
| `ammonia_high` | Ammonia level too high |
| `node_offline` | Node went offline      |
| `ai_anomaly`   | AI detected anomaly    |

---

### GET `/api/v1/rbw/{rbw_id}/alerts` â€” List Alerts by RBW

**Auth:** ğŸ”’ Bearer Token

**Response:** `200 OK` â€” Array of Alert objects for specific RBW.

---

### PATCH `/api/v1/alerts/{alert_id}/read` â€” Mark Alert as Read

**Auth:** ğŸ”’ Bearer Token

**Response:** `200 OK`

**Errors:** `404` â€” Alert not found.

---

### PATCH `/api/v1/alerts/{alert_id}/resolve` â€” Resolve Alert

**Auth:** ğŸ”’ Bearer Token

**Response:** `200 OK`

**Errors:** `404` â€” Alert not found.

---

## 9. Harvest Endpoints

### POST `/api/v1/harvests` â€” Create Harvest

**Auth:** ğŸ”’ Bearer Token

**Request Body:**

```json
{
  "rbw_id": "uuid",
  "node_id": "uuid",
  "floor_no": 1,
  "harvested_at": "2026-02-09T08:00:00Z",
  "nests_count": 50,
  "weight_kg": 2.5,
  "grade": "good",
  "notes": "Test harvest"
}
```

| Field          | Type     | Required | Validation               |
| -------------- | -------- | -------- | ------------------------ |
| `rbw_id`       | string   | âœ…       | Valid RBW UUID           |
| `node_id`      | string   | âŒ       | Valid Node UUID          |
| `floor_no`     | int      | âœ…       | Min 1                    |
| `harvested_at` | datetime | âœ…       | ISO 8601                 |
| `nests_count`  | int      | âŒ       | Min 0                    |
| `weight_kg`    | float    | âŒ       | Weight in kg             |
| `grade`        | string   | âŒ       | `good`, `medium`, `poor` |
| `notes`        | string   | âŒ       | -                        |

**Response:** `201 Created`

```json
{
  "success": true,
  "data": {
    "id": "uuid",
    "rbw_id": "uuid",
    "node_id": null,
    "floor_no": 1,
    "harvested_at": "2026-02-09T08:00:00Z",
    "nests_count": 50,
    "weight_kg": 2.5,
    "grade": "good",
    "notes": "Test harvest",
    "created_by": "uuid",
    "cycle_days": 45,
    "created_at": "2026-02-09T10:00:00Z",
    "updated_at": "2026-02-09T10:00:00Z"
  }
}
```

---

### GET `/api/v1/harvests` â€” List All Harvests

**Auth:** ğŸ”’ Bearer Token

**Query:** `?page=1&limit=20&rbw_id=uuid`

**Response:** `200 OK` â€” Array of Harvest objects with pagination meta.

---

### GET `/api/v1/harvests/{id}` â€” Get Harvest

**Auth:** ğŸ”’ Bearer Token

**Response:** `200 OK` â€” Single Harvest object.

---

### PATCH `/api/v1/harvests/{id}` â€” Update Harvest

**Auth:** ğŸ”’ Bearer Token

**Request Body** (all optional):

```json
{
  "floor_no": 2,
  "nests_count": 55,
  "weight_kg": 2.8,
  "grade": "good",
  "notes": "Updated notes"
}
```

**Response:** `200 OK` â€” Updated Harvest object.

---

### DELETE `/api/v1/harvests/{id}` â€” Delete Harvest

**Auth:** ğŸ”’ Bearer Token

**Response:** `200 OK`

---

### GET `/api/v1/harvests/stats` â€” Get Harvest Statistics

**Auth:** ğŸ”’ Bearer Token

**Query:** `?rbw_id=uuid` (optional filter)

**Response:** `200 OK`

```json
{
  "success": true,
  "data": {
    "total_harvests": 25,
    "total_nests": 1250,
    "total_weight_kg": 62.5,
    "avg_nests_per_harvest": 50.0,
    "avg_weight_kg": 2.5,
    "avg_cycle_days": 42.0
  }
}
```

---

### GET `/api/v1/rbw/{rbw_id}/harvests` â€” List Harvests by RBW

**Auth:** ğŸ”’ Bearer Token

**Query:** `?page=1&limit=20`

**Response:** `200 OK` â€” Array of Harvest objects for specific RBW.

---

## 10. Service Request Endpoints

### POST `/api/v1/service-requests` â€” Create Service Request

**Auth:** ğŸ”’ Bearer Token

**Request Body:**

```json
{
  "rbw_id": "uuid",
  "node_id": "uuid",
  "type": "maintenance",
  "issue": "Sensor malfunction on floor 2"
}
```

| Field     | Type   | Required | Values                                     |
| --------- | ------ | -------- | ------------------------------------------ |
| `rbw_id`  | string | âœ…       | Valid RBW UUID                             |
| `node_id` | string | âŒ       | Specific node                              |
| `type`    | string | âœ…       | `installation`, `maintenance`, `uninstall` |
| `issue`   | string | âŒ       | Issue description                          |

**Response:** `201 Created`

```json
{
  "success": true,
  "data": {
    "id": "uuid",
    "rbw_id": "uuid",
    "node_id": null,
    "request_by": "uuid",
    "assigned_to": null,
    "approved_by": null,
    "type": "maintenance",
    "status": "draft",
    "request_date": "2026-02-09T10:00:00Z",
    "schedule_date": null,
    "uninstall_date": null,
    "issue": "Sensor malfunction on floor 2",
    "resolution": null,
    "notes": null,
    "created_at": "2026-02-09T10:00:00Z",
    "updated_at": "2026-02-09T10:00:00Z"
  }
}
```

### Service Request Status Flow

```
draft â†’ pending â†’ approved â†’ assigned â†’ in_progress â†’ resolved
                â†’ rejected
                                                      â†’ cancelled
```

| Status        | Description            |
| ------------- | ---------------------- |
| `draft`       | Initial state          |
| `pending`     | Awaiting approval      |
| `approved`    | Approved by admin      |
| `rejected`    | Rejected               |
| `assigned`    | Assigned to technician |
| `in_progress` | Work in progress       |
| `resolved`    | Completed              |
| `cancelled`   | Cancelled              |

---

### GET `/api/v1/service-requests` â€” List Service Requests

**Auth:** ğŸ”’ Bearer Token

**Query Parameters:**

| Param         | Type   | Description         |
| ------------- | ------ | ------------------- |
| `page`        | int    | Page number         |
| `limit`       | int    | Items per page      |
| `rbw_id`      | string | Filter by RBW       |
| `status`      | string | Filter by status    |
| `request_by`  | string | Filter by requester |
| `assigned_to` | string | Filter by assignee  |

**Response:** `200 OK` â€” Array of ServiceRequest objects with pagination meta.

---

### GET `/api/v1/service-requests/{id}` â€” Get Service Request

**Auth:** ğŸ”’ Bearer Token

**Response:** `200 OK` â€” Single ServiceRequest object.

---

### PATCH `/api/v1/service-requests/{id}` â€” Update Service Request

**Auth:** ğŸ”’ Bearer Token

**Request Body** (all optional):

```json
{
  "status": "pending",
  "assigned_to": "technician-uuid",
  "schedule_date": "2026-02-15T09:00:00Z",
  "resolution": "Sensor replaced",
  "notes": "Escalated for review"
}
```

**Response:** `200 OK` â€” Updated ServiceRequest object.

---

## 11. Transaction Endpoints

### POST `/api/v1/transactions` â€” Create Transaction

**Auth:** ğŸ”’ Bearer Token

**Request Body:**

```json
{
  "rbw_id": "uuid",
  "category_id": "uuid",
  "amount": 500000,
  "type": "income",
  "description": "Nest sale batch #12",
  "transaction_date": "2026-02-09T00:00:00Z"
}
```

| Field              | Type     | Required | Values              |
| ------------------ | -------- | -------- | ------------------- |
| `rbw_id`           | string   | âœ…       | Valid RBW UUID      |
| `category_id`      | string   | âœ…       | Valid Category UUID |
| `amount`           | float    | âœ…       | Transaction amount  |
| `type`             | string   | âœ…       | `income`, `expense` |
| `description`      | string   | âŒ       | Description         |
| `transaction_date` | datetime | âœ…       | ISO 8601            |

**Response:** `201 Created`

```json
{
  "success": true,
  "data": {
    "id": "uuid",
    "rbw_id": "uuid",
    "category_id": "uuid",
    "amount": 500000,
    "type": "income",
    "description": "Nest sale batch #12",
    "transaction_date": "2026-02-09T00:00:00Z",
    "created_by": "uuid",
    "created_at": "2026-02-09T10:00:00Z",
    "updated_at": "2026-02-09T10:00:00Z"
  }
}
```

---

### GET `/api/v1/transactions/{id}` â€” Get Transaction

**Auth:** ğŸ”’ Bearer Token

**Response:** `200 OK` â€” Single Transaction object.

---

### PATCH `/api/v1/transactions/{id}` â€” Update Transaction

**Auth:** ğŸ”’ Bearer Token

**Request Body** (all optional):

```json
{
  "category_id": "uuid",
  "amount": 600000,
  "description": "Updated description"
}
```

**Response:** `200 OK` â€” Updated Transaction object.

---

### DELETE `/api/v1/transactions/{id}` â€” Delete Transaction

**Auth:** ğŸ”’ Bearer Token

**Response:** `200 OK`

---

### GET `/api/v1/rbw/{rbw_id}/transactions` â€” List Transactions by RBW

**Auth:** ğŸ”’ Bearer Token

**Query Parameters:**

| Param        | Type   | Description                 |
| ------------ | ------ | --------------------------- |
| `page`       | int    | Page number                 |
| `limit`      | int    | Items per page              |
| `type`       | string | Filter: `income`, `expense` |
| `start_date` | string | Start date filter           |
| `end_date`   | string | End date filter             |

**Response:** `200 OK` â€” Array of Transaction objects with pagination meta.

---

## 12. Transaction Category Endpoints

### GET `/api/v1/transaction-categories` â€” List Categories

**Auth:** ğŸ”’ Bearer Token

**Response:** `200 OK`

```json
{
  "success": true,
  "data": [
    {
      "id": "uuid",
      "name": "Penjualan Sarang",
      "type": "income",
      "description": "Revenue from nest sales",
      "created_at": "2026-01-01T00:00:00Z"
    }
  ]
}
```

---

### POST `/api/v1/transaction-categories` â€” Create Category (Admin)

**Auth:** ğŸ”’ Bearer Token (Admin only)

**Request Body:**

```json
{
  "name": "Penjualan Sarang",
  "type": "income",
  "description": "Revenue from nest sales"
}
```

| Field         | Type   | Required | Values              |
| ------------- | ------ | -------- | ------------------- |
| `name`        | string | âœ…       | Category name       |
| `type`        | string | âœ…       | `income`, `expense` |
| `description` | string | âŒ       | Description         |

**Response:** `201 Created`

---

### PATCH `/api/v1/transaction-categories/{id}` â€” Update Category (Admin)

**Auth:** ğŸ”’ Bearer Token (Admin only)

**Request Body** (all optional):

```json
{
  "name": "Updated Category Name",
  "description": "Updated description"
}
```

**Response:** `200 OK`

---

### DELETE `/api/v1/transaction-categories/{id}` â€” Delete Category (Admin)

**Auth:** ğŸ”’ Bearer Token (Admin only)

**Response:** `200 OK`

---

## 13. Financial Statement Endpoints

### POST `/api/v1/financial-statements` â€” Generate Financial Statement

**Auth:** ğŸ”’ Bearer Token

**Request Body:**

```json
{
  "rbw_id": "uuid",
  "start_date": "2026-01-01",
  "end_date": "2026-12-31"
}
```

| Field        | Type   | Required | Format       |
| ------------ | ------ | -------- | ------------ |
| `rbw_id`     | string | âœ…       | UUID         |
| `start_date` | string | âœ…       | `YYYY-MM-DD` |
| `end_date`   | string | âœ…       | `YYYY-MM-DD` |

**Response:** `200 OK`

```json
{
  "success": true,
  "data": {
    "rbw_id": "uuid",
    "start_date": "2026-01-01T00:00:00Z",
    "end_date": "2026-12-31T00:00:00Z",
    "total_income": 15000000,
    "total_expense": 5000000,
    "balance": 10000000,
    "incomes": [
      {
        "id": "uuid",
        "rbw_id": "uuid",
        "category_id": "uuid",
        "amount": 500000,
        "type": "income",
        "description": "Nest sale",
        "transaction_date": "2026-02-09T00:00:00Z",
        "created_by": "uuid",
        "created_at": "2026-02-09T10:00:00Z",
        "updated_at": "2026-02-09T10:00:00Z"
      }
    ],
    "expenses": []
  }
}
```

---

## 14. AI Engine Endpoints

> **Note:** AI Engine may be disabled in production. When disabled, all prediction endpoints return `503 Service Unavailable`.

### GET `/api/v1/ai/health` â€” AI Health Check

**Auth:** ğŸ”’ Bearer Token

**Response:** `200 OK`

```json
{
  "success": true,
  "data": {
    "status": "healthy",
    "version": "1.0.0"
  }
}
```

---

### POST `/api/v1/ai/predict-grade` â€” Predict Harvest Grade

**Auth:** ğŸ”’ Bearer Token

**Request Body:**

```json
{
  "temperature": 28.5,
  "humidity": 75.0,
  "ammonia": 15.0,
  "rbw_id": "uuid",
  "node_id": "uuid"
}
```

| Field         | Type   | Required | Description         |
| ------------- | ------ | -------- | ------------------- |
| `temperature` | float  | âœ…       | Temperature (Â°C)    |
| `humidity`    | float  | âœ…       | Humidity (%)        |
| `ammonia`     | float  | âœ…       | Ammonia level (ppm) |
| `rbw_id`      | string | âŒ       | Context RBW         |
| `node_id`     | string | âŒ       | Context Node        |

**Response:** `200 OK`

```json
{
  "success": true,
  "data": {
    "grade": "good",
    "confidence": 0.92,
    "probabilities": {
      "good": 0.92,
      "medium": 0.06,
      "poor": 0.02
    }
  }
}
```

---

### POST `/api/v1/ai/predict-pump` â€” Predict Pump Action

**Auth:** ğŸ”’ Bearer Token

**Request Body:**

```json
{
  "temperature": 32.0,
  "humidity": 65.0,
  "ammonia": 20.0,
  "rbw_id": "uuid",
  "node_id": "uuid"
}
```

**Response:** `200 OK`

```json
{
  "success": true,
  "data": {
    "pump_state": "on",
    "confidence": 0.88,
    "duration_minutes": 15.0
  }
}
```

---

### POST `/api/v1/ai/analyze` â€” Comprehensive Analysis

**Auth:** ğŸ”’ Bearer Token

**Request Body:**

```json
{
  "temperature": 28.5,
  "humidity": 75.0,
  "ammonia": 15.0,
  "rbw_id": "uuid",
  "node_id": "uuid"
}
```

**Response:** `200 OK`

```json
{
  "success": true,
  "data": {
    "overall_health_score": 85.5,
    "sensors": {
      "temperature": {
        "value": 28.5,
        "unit": "Â°C",
        "status": "normal",
        "health_score": 90.0
      },
      "humidity": {
        "value": 75.0,
        "unit": "%",
        "status": "normal",
        "health_score": 85.0
      },
      "ammonia": {
        "value": 15.0,
        "unit": "ppm",
        "status": "warning",
        "health_score": 70.0
      }
    },
    "grade_prediction": {
      "grade": "good",
      "confidence": 0.92,
      "probabilities": { "good": 0.92, "medium": 0.06, "poor": 0.02 }
    },
    "pump_recommendation": {
      "pump_state": "off",
      "confidence": 0.95,
      "duration_minutes": 0
    },
    "recommendations": [
      {
        "priority": "medium",
        "type": "ventilation",
        "message": "Consider increasing ventilation to reduce ammonia levels"
      }
    ]
  }
}
```

---

### POST `/api/v1/ai/anomaly-detect` â€” Anomaly Detection

**Auth:** ğŸ”’ Bearer Token

**Request Body:**

```json
{
  "sensor_id": "uuid",
  "sensor_type": "temp",
  "rbw_id": "uuid",
  "node_id": "uuid",
  "recorded_at": "2026-02-09T10:00:00Z",
  "value": 45.0
}
```

**Response:** `200 OK`

```json
{
  "success": true,
  "data": {
    "is_anomaly": true,
    "score": 0.95,
    "reason": "Temperature abnormally high"
  }
}
```

---

## 15. Upload Endpoints

### POST `/api/v1/uploads/avatar` â€” Upload Avatar

**Auth:** ğŸ”’ Bearer Token

**Content-Type:** `multipart/form-data`

| Field  | Type | Description            |
| ------ | ---- | ---------------------- |
| `file` | file | Image file (JPEG, PNG) |

**Response:** `200 OK`

```json
{
  "success": true,
  "data": {
    "url": "https://storage.example.com/avatars/uuid.jpg"
  }
}
```

**Errors:** `503` â€” Storage not available

---

### POST `/api/v1/uploads/rbw/{rbw_id}/photo` â€” Upload RBW Photo

**Auth:** ğŸ”’ Bearer Token

**Content-Type:** `multipart/form-data`

| Field  | Type | Description            |
| ------ | ---- | ---------------------- |
| `file` | file | Image file (JPEG, PNG) |

**Response:** `200 OK`

```json
{
  "success": true,
  "data": {
    "url": "https://storage.example.com/rbw/uuid.jpg"
  }
}
```

**Errors:** `503` â€” Storage not available

---

## 16. WebSocket Endpoints

### GET `/api/v1/ws` â€” WebSocket Connection

**Auth:** ğŸ”’ Bearer Token (via query param `?token=xxx`)

Connects to real-time data stream for live sensor data, alerts, and node status updates.

**Connection:**

```
wss://api.swiftlead.fuadfakhruz.com/api/v1/ws?token=<jwt_token>
```

---

### GET `/api/v1/ws/stats` â€” WebSocket Stats

**Auth:** ğŸ”’ Bearer Token

**Response:** `200 OK`

```json
{
  "success": true,
  "data": {
    "connected_clients": 5,
    "total_messages": 1234
  }
}
```

---

## 17. Health & Metrics

### GET `/health` â€” Health Check

**Auth:** None

**Response:** `200 OK` â€” Plain text `OK`

---

### GET `/metrics` â€” Prometheus Metrics

**Auth:** None

**Response:** `200 OK` â€” Prometheus-formatted metrics.

---

## Quick Reference â€” All Endpoints

| Method   | Endpoint                               | Auth | Role  | Description              |
| -------- | -------------------------------------- | ---- | ----- | ------------------------ |
| `POST`   | `/api/v1/auth/register`                | âŒ   | -     | Public registration      |
| `POST`   | `/api/v1/auth/login`                   | âŒ   | -     | Login                    |
| `POST`   | `/api/v1/auth/change-password`         | ğŸ”’   | Any   | Change password          |
| `POST`   | `/api/v1/auth/forgot-password`         | ğŸ”’   | Admin | Reset user password      |
| `POST`   | `/api/v1/auth/admin/register`          | ğŸ”’   | Admin | Admin register user      |
| `GET`    | `/api/v1/users/me`                     | ğŸ”’   | Any   | Get my profile           |
| `PATCH`  | `/api/v1/users/me`                     | ğŸ”’   | Any   | Update my profile        |
| `GET`    | `/api/v1/users`                        | ğŸ”’   | Admin | List users               |
| `POST`   | `/api/v1/users`                        | ğŸ”’   | Admin | Create user              |
| `GET`    | `/api/v1/rbw`                          | ğŸ”’   | Any   | List RBWs                |
| `POST`   | `/api/v1/rbw`                          | ğŸ”’   | Any   | Create RBW               |
| `GET`    | `/api/v1/rbw/{rbw_id}`                 | ğŸ”’   | Any   | Get RBW                  |
| `PATCH`  | `/api/v1/rbw/{rbw_id}`                 | ğŸ”’   | Any   | Update RBW               |
| `DELETE` | `/api/v1/rbw/{rbw_id}`                 | ğŸ”’   | Any   | Delete RBW               |
| `GET`    | `/api/v1/rbw/{rbw_id}/nodes`           | ğŸ”’   | Any   | List nodes by RBW        |
| `POST`   | `/api/v1/rbw/{rbw_id}/nodes`           | ğŸ”’   | Any   | Create node              |
| `GET`    | `/api/v1/rbw/{rbw_id}/alerts`          | ğŸ”’   | Any   | List alerts by RBW       |
| `GET`    | `/api/v1/rbw/{rbw_id}/harvests`        | ğŸ”’   | Any   | List harvests by RBW     |
| `GET`    | `/api/v1/rbw/{rbw_id}/transactions`    | ğŸ”’   | Any   | List transactions by RBW |
| `GET`    | `/api/v1/nodes/{node_id}`              | ğŸ”’   | Any   | Get node                 |
| `PATCH`  | `/api/v1/nodes/{node_id}`              | ğŸ”’   | Any   | Update node              |
| `DELETE` | `/api/v1/nodes/{node_id}`              | ğŸ”’   | Any   | Delete node              |
| `GET`    | `/api/v1/nodes/{node_id}/sensors`      | ğŸ”’   | Any   | List sensors by node     |
| `POST`   | `/api/v1/nodes/{node_id}/sensors`      | ğŸ”’   | Any   | Create sensor            |
| `GET`    | `/api/v1/nodes/{node_id}/audio`        | ğŸ”’   | Any   | Get audio state          |
| `PATCH`  | `/api/v1/nodes/{node_id}/audio`        | ğŸ”’   | Any   | Control audio            |
| `PATCH`  | `/api/v1/nodes/{node_id}/pump`         | ğŸ”’   | Any   | Control pump             |
| `GET`    | `/api/v1/sensors/{sensor_id}`          | ğŸ”’   | Any   | Get sensor               |
| `PATCH`  | `/api/v1/sensors/{sensor_id}`          | ğŸ”’   | Any   | Update sensor            |
| `GET`    | `/api/v1/sensors/{sensor_id}/readings` | ğŸ”’   | Any   | Get readings             |
| `POST`   | `/api/v1/sensors/{sensor_id}/readings` | ğŸ”’   | Any   | Create reading           |
| `GET`    | `/api/v1/sensors/{sensor_id}/trend`    | ğŸ”’   | Any   | Get trend                |
| `GET`    | `/api/v1/alerts`                       | ğŸ”’   | Any   | List alerts              |
| `PATCH`  | `/api/v1/alerts/{alert_id}/read`       | ğŸ”’   | Any   | Mark alert read          |
| `PATCH`  | `/api/v1/alerts/{alert_id}/resolve`    | ğŸ”’   | Any   | Resolve alert            |
| `GET`    | `/api/v1/harvests`                     | ğŸ”’   | Any   | List harvests            |
| `POST`   | `/api/v1/harvests`                     | ğŸ”’   | Any   | Create harvest           |
| `GET`    | `/api/v1/harvests/stats`               | ğŸ”’   | Any   | Get harvest stats        |
| `GET`    | `/api/v1/harvests/{id}`                | ğŸ”’   | Any   | Get harvest              |
| `PATCH`  | `/api/v1/harvests/{id}`                | ğŸ”’   | Any   | Update harvest           |
| `DELETE` | `/api/v1/harvests/{id}`                | ğŸ”’   | Any   | Delete harvest           |
| `GET`    | `/api/v1/service-requests`             | ğŸ”’   | Any   | List service requests    |
| `POST`   | `/api/v1/service-requests`             | ğŸ”’   | Any   | Create service request   |
| `GET`    | `/api/v1/service-requests/{id}`        | ğŸ”’   | Any   | Get service request      |
| `PATCH`  | `/api/v1/service-requests/{id}`        | ğŸ”’   | Any   | Update service request   |
| `POST`   | `/api/v1/transactions`                 | ğŸ”’   | Any   | Create transaction       |
| `GET`    | `/api/v1/transactions/{id}`            | ğŸ”’   | Any   | Get transaction          |
| `PATCH`  | `/api/v1/transactions/{id}`            | ğŸ”’   | Any   | Update transaction       |
| `DELETE` | `/api/v1/transactions/{id}`            | ğŸ”’   | Any   | Delete transaction       |
| `GET`    | `/api/v1/transaction-categories`       | ğŸ”’   | Any   | List categories          |
| `POST`   | `/api/v1/transaction-categories`       | ğŸ”’   | Admin | Create category          |
| `PATCH`  | `/api/v1/transaction-categories/{id}`  | ğŸ”’   | Admin | Update category          |
| `DELETE` | `/api/v1/transaction-categories/{id}`  | ğŸ”’   | Admin | Delete category          |
| `POST`   | `/api/v1/financial-statements`         | ğŸ”’   | Any   | Generate statement       |
| `GET`    | `/api/v1/ai/health`                    | ğŸ”’   | Any   | AI health check          |
| `POST`   | `/api/v1/ai/predict-grade`             | ğŸ”’   | Any   | Predict grade            |
| `POST`   | `/api/v1/ai/predict-pump`              | ğŸ”’   | Any   | Predict pump action      |
| `POST`   | `/api/v1/ai/analyze`                   | ğŸ”’   | Any   | Comprehensive analysis   |
| `POST`   | `/api/v1/ai/anomaly-detect`            | ğŸ”’   | Any   | Anomaly detection        |
| `POST`   | `/api/v1/uploads/avatar`               | ğŸ”’   | Any   | Upload avatar            |
| `POST`   | `/api/v1/uploads/rbw/{rbw_id}/photo`   | ğŸ”’   | Any   | Upload RBW photo         |
| `GET`    | `/api/v1/ws`                           | ğŸ”’   | Any   | WebSocket connection     |
| `GET`    | `/api/v1/ws/stats`                     | ğŸ”’   | Any   | WebSocket stats          |
| `GET`    | `/health`                              | âŒ   | -     | Health check             |
| `GET`    | `/metrics`                             | âŒ   | -     | Prometheus metrics       |